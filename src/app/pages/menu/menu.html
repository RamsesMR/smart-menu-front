<div class="menu-container">
  <div class="top-actions">
    <button class="btn-logout" (click)="logout()">Logout</button>
  </div>

  <div class="menu">
    <header class="top">
      <div class="top-row">
        <h1 class="title">Men√∫</h1>

        @if (modo === 'armar') {
          <div class="order-mini">
            <span>{{ totalItems }} items</span>
            <span class="dot">‚Ä¢</span>
            <span>{{ totalEuros | number: '1.2-2' }} ‚Ç¨</span>
          </div>
        }
      </div>

      <div class="search-row">
        <input class="search-input" placeholder="Buscar..." [(ngModel)]="search" />
      </div>

      <div class="chips-container">
        <button class="chip" [class.active]="catActiva === null" (click)="setCat(null)">
          Todo
        </button>

        @for (c of categorias; track c) {
          <button class="chip" [class.active]="catActiva === c" (click)="setCat(c)">
            {{ c }}
          </button>
        }
      </div>
    </header>

    <main class="grid" role="list">
      @for (p of productosFiltrados(); track p.id) {
        <article class="card" (click)="openProducto(p)">
          <div class="card-img-box">
            @if (p.kcal && p.kcal < 400) {
              <div class="smart-tag">Recomendado</div>
            }

            <div class="img-wrapper">
              @if (p.imagen) {
                <img [src]="p.imagen" [alt]="p.nombre" class="product-img" />
              } @else {
                <span class="placeholder-icon">üçΩÔ∏è</span>
              }
            </div>
          </div>

          <div class="meta">
            <h2 class="name">{{ p.nombre }}</h2>
            <p class="desc">{{ p.descripcion }}</p>

            @if (p.kcal) {
              <div class="kcal-badge">üî• {{ p.kcal }} kcal</div>
            }

            <div class="price">{{ p.precioConIva | number: '1.2-2' }} ‚Ç¨</div>
          </div>

          @if (modo === 'armar') {
            <div class="controls" (click)="$event.stopPropagation()">
              <button class="qty-btn" (click)="dec(p)">‚àí</button>
              <span class="count">{{ getQty(p) }}</span>
              <button class="qty-btn" (click)="inc(p)">+</button>
            </div>
          }
        </article>
      } @empty {
        <div class="empty-state">No se encontraron platos.</div>
      }
    </main>

    @if (modo === 'armar') {
      <footer class="bottom-actions">
        <button class="confirm-btn" (click)="irAPedir()">Confirmar mi pedido</button>
      </footer>
    }
  </div>
</div>
